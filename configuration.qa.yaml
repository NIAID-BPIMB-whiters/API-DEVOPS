# =============================================================================
# QA ENVIRONMENT - PUBLISHER CONFIGURATION
# =============================================================================
# TARGET ENVIRONMENT: QA (niaid-bpimb-apim-qa)
# 
# This file configures how the publisher deploys artifacts TO the QA environment.
# Repository artifacts are extracted FROM DAIDS_DEV and contain DAIDS_DEV resource
# references. This configuration remaps those references to QA resources.
#
# Pipeline: DAIDS_DEV (extract) → Repository → DEV → QA (deploy using this config)
# =============================================================================

# =============================================================================
# CONFIGURATION CAPABILITIES
# =============================================================================
# WHAT THIS CONFIGURATION FILE CAN DO:
# ✅ Remap APIM service name (apimServiceName)
# ✅ Remap named value Key Vault references (namedValues.properties.keyVault)
# ✅ Remap backend service URLs (backends.properties.url)
# ✅ Override API properties (apis.properties.path, protocols, etc.)
# ✅ Token substitution in artifacts using {{named-value-name}} syntax
# ✅ Exclude specific artifacts from deployment (apis, products, etc.)
# ✅ Override diagnostic verbosity levels (apis.diagnostics.properties.verbosity)
#
# WHAT THIS CONFIGURATION FILE CANNOT DO:
# ❌ Remap logger resource IDs in diagnostic configurations
#    Workaround: Use standardized logger names across all environments
# ❌ Remap self-hosted gateway names
#    Workaround: Use standardized gateway names or exclude from config
# ❌ Remap product IDs in subscription references
#    Workaround: Manually clean up subscriptions or use standardized product names
# ❌ Modify API operation paths or methods
#    Must be changed in OpenAPI specification files
# ❌ Remap policy XML resource references dynamically
#    Use named values for environment-specific values in policies instead
#
# APIops Version: v6.0.2
# See: https://github.com/Azure/apiops for feature documentation
# =============================================================================

apimServiceName: niaid-bpimb-apim-qa  # TARGET: QA APIM Service
namedValues:
  # Remap Key Vault references from source (DAIDS_DEV) to target (QA)
  # Repository contains: kv-niaid-apim-dev (from DAIDS_DEV)
  # Deploy using: kv-niaid-bpimb-apim-qa (in QA)
  - name: apim-ai-connection-string
    properties:
      keyVault:
        secretIdentifier: https://kv-niaid-bpimb-apim-qa.vault.azure.net/secrets/apim-ai-connection-string
loggers:
  # NOTE: APIops v6.0.2 does NOT support remapping logger resource IDs in diagnostics
  # This configuration creates/updates the logger itself, but diagnostic configs
  # that reference loggers by name will use the logger name from the repository.
  # WORKAROUND: Repository uses standardized logger name "niaid-bpimb-apim-ai"
  # across all environments, with environment-specific backing resources.
  # See Cross-Environment Architecture section in README for details.
  - name: apim-daids-connect-ai
    properties:
      loggerType: applicationInsights
      resourceId: /subscriptions/18fc6b8b-44fa-47d7-ae51-36766ac67165/resourceGroups/niaid-bpimb-apim-qa-rg/providers/Microsoft.Insights/components/niaid-bpimb-apim-qa-ai
      credentials:
        connectionString: "{{niaid-bpimb-apim-qa-ai-connection-string}}"
diagnostics:
backends:

# =============================================================================
# SOAP/WSDL API MANAGEMENT NOTES
# =============================================================================
# Microsoft has documented that the current version of Azure APIops (v6.0.2) 
# does NOT support SOAP/WSDL APIs for automated deployment via publisher tool.
# 
# WSDL APIs must be deployed and managed manually through the Azure Portal.
# 
# For future SOAP API management:
# - Deploy manually through Azure Portal APIM interface
# - Do not add SOAP/WSDL specification files to this repository
# - APIops will ignore any manually deployed SOAP APIs in the portal
# =============================================================================

apis:
  # Configuration overrides for APIs across environments can be added here
  # Example structure (for supported API types - REST/OpenAPI/GraphQL only):
  # - name: demo-conference-api
  #   diagnostics:
  #     - name: applicationinsights
  #       properties:
  #         verbosity: Error
